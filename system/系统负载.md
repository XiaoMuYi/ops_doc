# Linux性能优化总结以及排查思路

标签（空格分隔）： Linux system 性能优化

---

### 如何理解系统负载

平均负载是系统处于`可运行状态` 和 `不可中断状态`的平均进程数，也就是平均活跃进程数（单位时间内的活跃进程数）。**可运行状态的进程** 指的是正在使用CPU或等待可用CPU的进程，此时处于 R 状态（Running 或 Runnable）的进程。而 **不可中断的进程** 则表示的是正处于内核状态关键流程的进程，并且该进程不可被中断。比如，常见的硬件 I/O 响应，不可中断状态实际上是系统对进程和硬件设备的一种保护机制。

平均负载的大小与 **正在使用CPU的进程、等待可用CPU进程以及等待I/O的进程** 有关。

### 系统负载排查工具说明
> * mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标，以及所有 CPU 的平均指标。
> * pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、I/O 以及上下文切换等性能指标。
> * htop，atop 可作为替代 top 命令使用。

**1. CPU密集型进程**
```
mpstat -P ALL 5 # -P ALL表示监控所有CPU，5表示每5秒刷新一次数据，观察是否有某个cpu的%usr会很高，但iowait应很低
pidstat -u 5 1  # 每5秒输出一组数据，观察哪个进程%cpu很高，但是%wait很低，极有可能就是这个进程导致cpu飚高
```
**2. IO密集型进程**
```
mpstat -P ALL 5 # 观察是否有某个cpu的%iowait很高，同时%usr也较高
pidstat -u 5 1  # 观察哪个进程%wait较高，同时%CPU也较高
```
**3. 大量进程**
```
pidstat -u 5 1  # 观察那些%wait较高的进程是否有很多
```
