# 关于http协议

## 1.认识http协议

`HTTP`就是超文本传输协议，也就是`HyperText Transfer Protocol`。是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。而且需要知道`HHTP`不是互联网、不是编程语言、不是HTML，也不是一个孤立的协议。

`HTTP`协议的请求报文和响应报文的结构基本相同，由以下3部分组成：
* 起始行（start line），描述请求和响应的基本信息；
* 头部字段集合（header），使用`key-value`形式更详细地说明报文；
* 消息正文（entity），实际传输的数据，它不一定是纯文本，可以是图片、视频等二进制数据；

起始行和头部字段经常又被称为 **“请求头”** 或 **“响应头”**。消息正文又被称为 **“实体”**。但与`header`对应，很多时候就直接称为`body`。在`HTTP`协议报文中，`header`是必须的，`body`可以没有。并且在`header`之后必须包含一个空行，也就是`CRLF`。

### 1.1 请求行
起始行也就是请求行，主要是简述客户端想要如何操作服务器端的资源。由以下三部分构成：

* 请求方法，比如GET/PUT/POST等，表示对资源的操作；
* 请求目标，通常是一个`URI`，标记请求方法要操作的资源；
* 版本号，表示报文使用的`HTTP`协议版本号；

这三部分通常是空格（SP）分割，使用`CRLF`换行表示结束。

### 1.2 状态行
响应报文里的起始行，注意这里它不叫“响应行”，而是 **状态行（status line）**，意思是服务器响应的状态。它主要由以下三部分构成：

* 版本号，表示报文使用的`HTTP`协议版本号；
* 状态码，比如200是成功，500是服务器错误；
* 原因，作为状态码补充，更详细的文字说明，帮助人理解原因；

这三部分通常也是空格（SP）分割，使用`CRLF`换行表示结束。

### 1.3 头部字段
请求行和状态行在加上头部字段集合就构成了`HTTP`报文里完整的请求头或相应头。

## 2.关于HTTP状态码

1xx：提示信息，表示目前是协议处理的中间状态，还需要后续操作；
2xx：成功，报文已经收到并正确处理；
* 200 是最常见的成功状态码，如果非HEAD请求，通常在响应头后都会有 body 数据；
* 204 No Content，与 200基本相同，区别就是响应头没有 body 数据；
* 206 Partial Content，是HTTP 分块下载或断点续传的基础，但在 body 里的数据不是全部资源而是部分资源。

3xx：重定向，资源位置发生变动，需要客户端重新发送请求；

* 301 Moved Permanently 俗称永久重定向，含义是此次请求资源已经不存在，需要改用新的URI再次访问；
* 302 Found，临时重定向。请求的资源还在，但暂时需要用另一个URI 访问；
* 304 Not Modified，用于 If-Modified-Since 等条件请求，表示资源未修改，用于缓存控制。

4xx：客户端错误，请求报文有误，服务器无法处理；

* 400 Bad Request 表示请求报文错误；
* 403 Forbidden 表示服务器禁止访问资源；
* 404 Not Found 资源在服务器中未找到；
* 405 Method Not Allowed，不允许使用某些方法操作资源；
* 406 Not Acceptable 资源无法满足客户端请求条件，例如请求中文但只有英文；
* 408 Request Timeout 请求超时，服务器等待时间过长；
* 409 Conflict 多个请求发送了冲突，可以理解为多线程并发时的竟态；
* 413 Request Entity Too Large 请求报文里的 body 太大；
* 414 Request-URI Too Long 请求行里的URI太大；
* 429 Too many Requests 客户端发送了太多的请求，通常是由于服务器的限连策略；
* 413 Request Header Fields Too Large 请求头某个字段或总体太大；

5xx：服务器错误，服务器在处理请求时内部发生错误。

* 500 Internal Server Error 与 400类似，不知道为啥；
* 501 Not Implemented 表示客户端请求的功能还不支持；
* 502 Bad Gateway 网关或代理错误，一般表示后端服务器发生错误；
* 503 Service Unavailable 表示服务器很忙，暂时无法响应服务；

**案例分析** 
一般情况下`4xx`是服务端业务状态码，需要业务开发人员解决。`5xx`是比较常见的，比如500、502在LNMP架构中，500 就是因为业务代码写的不合理，导致`NGINX`的`upstream`接受错误，抛出了异常。

502 就是`php-fpm`挂了。

504 说明有慢查询`php-fpm`可能还在运行，由于`nginx`本身的超时设置已经主动断开。

